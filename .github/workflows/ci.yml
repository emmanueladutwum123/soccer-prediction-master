name: Soccer Prediction CI/CD Pipeline

on:
  push:
    branches: [main]
  workflow_dispatch:

jobs:
  setup-and-test:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
    
    - name: Setup Python 3.10
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
    
    - name: Create project structure
      run: |
        echo "ğŸ“ Creating project structure..."
        
        # Create directories
        mkdir -p data/raw data/processed data/features
        mkdir -p models/training models/trained_models models/evaluation
        mkdir -p src/data_collection src/feature_engineering src/modeling src/prediction src/web_app
        mkdir -p tests docs notebooks
        mkdir -p web_app/static web_app/templates
        
        echo "âœ… Project structure created"
    
    - name: Create __init__.py files
      run: |
        echo "ğŸ“„ Creating __init__.py files..."
        
        # Create __init__.py files for Python packages
        touch src/__init__.py
        touch src/data_collection/__init__.py
        touch src/feature_engineering/__init__.py
        touch src/modeling/__init__.py
        touch src/prediction/__init__.py
        touch src/web_app/__init__.py
        touch web_app/__init__.py
        
        echo "âœ… __init__.py files created"
    
    - name: Create requirements.txt
      run: |
        echo "ğŸ“¦ Creating requirements.txt..."
        cat << 'REQUIREMENTS' > requirements.txt
# Core packages
pandas==2.0.3
numpy==1.24.3
scikit-learn==1.3.0
scipy==1.11.1

# ML/DL
xgboost==1.7.6
lightgbm==4.0.0

# Data collection
requests==2.31.0
beautifulsoup4==4.12.2

# Web app
flask==3.0.0
plotly==5.17.0

# Utilities
python-dotenv==1.0.0
joblib==1.3.1
REQUIREMENTS
        
        echo "âœ… requirements.txt created"
    
    - name: Create setup.py
      run: |
        echo "âš™ï¸ Creating setup.py..."
        cat << 'SETUP' > setup.py
#!/usr/bin/env python3
"""
Setup script for Soccer Prediction Master
"""
import os
from pathlib import Path

print("ğŸš€ Setting up Soccer Prediction Master...")

# Create directory structure
folders = [
    'data/raw', 'data/processed', 'data/features',
    'models/training', 'models/trained_models', 'models/evaluation',
    'src/data_collection', 'src/feature_engineering', 
    'src/modeling', 'src/prediction', 'src/web_app',
    'tests', 'docs', 'notebooks',
    'web_app/static', 'web_app/templates'
]

for folder in folders:
    Path(folder).mkdir(parents=True, exist_ok=True)
    print(f"  ğŸ“ Created: {folder}")

print("\nâœ… Setup complete!")
print("\nNext: pip install -r requirements.txt")
SETUP
        
        echo "âœ… setup.py created"
    
    - name: Create main.py
      run: |
        echo "ğŸ¯ Creating main.py..."
        cat << 'MAIN' > main.py
#!/usr/bin/env python3
"""
Soccer Prediction Master - Main Entry Point
"""
print("âš½ Soccer Prediction Master")
print("============================")
print("Project setup successful!")
print("\nTo get started:")
print("1. Install dependencies: pip install -r requirements.txt")
print("2. Run: python setup.py (if not already done)")
print("3. Start building your prediction system")
MAIN
        
        echo "âœ… main.py created"
    
    - name: Create README.md if missing
      run: |
        if [ ! -f "README.md" ]; then
          echo "ğŸ“š Creating README.md..."
          cat << 'README' > README.md
# âš½ Soccer Prediction Master

Advanced machine learning system for soccer match predictions.

## Setup

1. Clone repository
2. Run: \`python setup.py\`
3. Install: \`pip install -r requirements.txt\`
4. Start building!

## Project Structure

- \`data/\` - Match data
- \`src/\` - Source code
- \`models/\` - ML models
- \`web_app/\` - Dashboard

## License
MIT License
README
          echo "âœ… README.md created"
        else
          echo "ğŸ“š README.md already exists"
        fi
    
    - name: Install dependencies
      run: |
        echo "ğŸ“¦ Installing dependencies..."
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        echo "âœ… Dependencies installed"
    
    - name: Verify installation
      run: |
        echo "ğŸ§ª Verifying installation..."
        python -c "
import pandas as pd
import numpy as np
import sklearn
import flask
print('âœ… All packages imported successfully!')
print(f'Pandas version: {pd.__version__}')
print(f'NumPy version: {np.__version__}')
        "
    
    - name: Test project
      run: |
        echo "ğŸ§ª Testing project..."
        
        # Check structure
        echo "ğŸ“ Checking project structure..."
        [ -f "requirements.txt" ] && echo "âœ… requirements.txt exists"
        [ -f "setup.py" ] && echo "âœ… setup.py exists"
        [ -f "main.py" ] && echo "âœ… main.py exists"
        [ -d "src/data_collection" ] && echo "âœ… src/data_collection exists"
        [ -f "src/__init__.py" ] && echo "âœ… src/__init__.py exists"
        
        # Test Python
        python -c "
print('Testing Python...')
from pathlib import Path
print(f'Current directory: {Path.cwd()}')
print('âœ… Python test passed')
        "
        
        echo "âœ… All tests passed!"
    
    - name: Create workflow summary
      run: |
        echo "## ğŸ“Š Workflow Summary" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "### âœ… Project Setup Complete" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "**Files Created:**" >> $GITHUB_STEP_SUMMARY
        echo "- ğŸ“ Project structure with 16 directories" >> $GITHUB_STEP_SUMMARY
        echo "- ğŸ“¦ requirements.txt with 10 packages" >> $GITHUB_STEP_SUMMARY
        echo "- âš™ï¸ setup.py script" >> $GITHUB_STEP_SUMMARY
        echo "- ğŸ¯ main.py entry point" >> $GITHUB_STEP_SUMMARY
        echo "- ğŸ“š README.md documentation" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "**Dependencies Installed:**" >> $GITHUB_STEP_SUMMARY
        echo "- pandas, numpy, scikit-learn" >> $GITHUB_STEP_SUMMARY
        echo "- xgboost, lightgbm" >> $GITHUB_STEP_SUMMARY
        echo "- flask, plotly" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "**Next Steps:**" >> $GITHUB_STEP_SUMMARY
        echo "1. Start building data collection module" >> $GITHUB_STEP_SUMMARY
        echo "2. Implement feature engineering" >> $GITHUB_STEP_SUMMARY
        echo "3. Train ML models" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "**Status:** âœ… Success" >> $GITHUB_STEP_SUMMARY
        echo "**Time:** $(date)" >> $GITHUB_STEP_SUMMARY

  success-notification:
    needs: setup-and-test
    if: success()
    runs-on: ubuntu-latest
    steps:
      - name: Success
        run: |
          echo "ğŸ‰ CI/CD Pipeline Completed Successfully!"
          echo "Your Soccer Prediction Master project is ready."
