name: Soccer Prediction CI/CD Pipeline

on:
  push:
    branches: [main]
  workflow_dispatch:

jobs:
  setup-and-test:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
    
    - name: Setup Python 3.10
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
    
    - name: Create project structure
      run: |
        echo "ðŸ“ Creating project structure..."
        mkdir -p data/raw data/processed data/features
        mkdir -p models/training models/trained_models models/evaluation
        mkdir -p src/data_collection src/feature_engineering src/modeling src/prediction src/web_app
        mkdir -p tests docs notebooks
        mkdir -p web_app/static web_app/templates
        echo "âœ… Project structure created"
    
    - name: Create __init__.py files
      run: |
        echo "ðŸ“„ Creating __init__.py files..."
        touch src/__init__.py
        touch src/data_collection/__init__.py
        touch src/feature_engineering/__init__.py
        touch src/modeling/__init__.py
        touch src/prediction/__init__.py
        touch src/web_app/__init__.py
        touch web_app/__init__.py
        echo "âœ… __init__.py files created"
    
    - name: Create requirements.txt
      run: |
        echo "ðŸ“¦ Creating requirements.txt..."
        echo "# Core packages" > requirements.txt
        echo "pandas==2.0.3" >> requirements.txt
        echo "numpy==1.24.3" >> requirements.txt
        echo "scikit-learn==1.3.0" >> requirements.txt
        echo "scipy==1.11.1" >> requirements.txt
        echo "" >> requirements.txt
        echo "# ML/DL" >> requirements.txt
        echo "xgboost==1.7.6" >> requirements.txt
        echo "lightgbm==4.0.0" >> requirements.txt
        echo "" >> requirements.txt
        echo "# Data collection" >> requirements.txt
        echo "requests==2.31.0" >> requirements.txt
        echo "beautifulsoup4==4.12.2" >> requirements.txt
        echo "" >> requirements.txt
        echo "# Web app" >> requirements.txt
        echo "flask==3.0.0" >> requirements.txt
        echo "plotly==5.17.0" >> requirements.txt
        echo "" >> requirements.txt
        echo "# Utilities" >> requirements.txt
        echo "python-dotenv==1.0.0" >> requirements.txt
        echo "joblib==1.3.1" >> requirements.txt
        echo "âœ… requirements.txt created"
    
    - name: Create setup.py
      run: |
        echo "âš™ï¸ Creating setup.py..."
        echo '#!/usr/bin/env python3' > setup.py
        echo '"""' >> setup.py
        echo 'Setup script for Soccer Prediction Master' >> setup.py
        echo '"""' >> setup.py
        echo 'import os' >> setup.py
        echo 'from pathlib import Path' >> setup.py
        echo '' >> setup.py
        echo 'print("ðŸš€ Setting up Soccer Prediction Master...")' >> setup.py
        echo '' >> setup.py
        echo '# Create directory structure' >> setup.py
        echo 'folders = [' >> setup.py
        echo "    'data/raw', 'data/processed', 'data/features'," >> setup.py
        echo "    'models/training', 'models/trained_models', 'models/evaluation'," >> setup.py
        echo "    'src/data_collection', 'src/feature_engineering'," >> setup.py
        echo "    'src/modeling', 'src/prediction', 'src/web_app'," >> setup.py
        echo "    'tests', 'docs', 'notebooks'," >> setup.py
        echo "    'web_app/static', 'web_app/templates'" >> setup.py
        echo ']' >> setup.py
        echo '' >> setup.py
        echo 'for folder in folders:' >> setup.py
        echo '    Path(folder).mkdir(parents=True, exist_ok=True)' >> setup.py
        echo '    print(f"  ðŸ“ Created: {folder}")' >> setup.py
        echo '' >> setup.py
        echo 'print("\nâœ… Setup complete!")' >> setup.py
        echo 'print("\nNext: pip install -r requirements.txt")' >> setup.py
        echo "âœ… setup.py created"
    
    - name: Create main.py
      run: |
        echo "ðŸŽ¯ Creating main.py..."
        echo '#!/usr/bin/env python3' > main.py
        echo '"""' >> main.py
        echo 'Soccer Prediction Master - Main Entry Point' >> main.py
        echo '"""' >> main.py
        echo 'print("âš½ Soccer Prediction Master")' >> main.py
        echo 'print("============================")' >> main.py
        echo 'print("Project setup successful!")' >> main.py
        echo 'print("\nTo get started:")' >> main.py
        echo 'print("1. Install dependencies: pip install -r requirements.txt")' >> main.py
        echo 'print("2. Run: python setup.py (if not already done)")' >> main.py
        echo 'print("3. Start building your prediction system")' >> main.py
        echo "âœ… main.py created"
    
    - name: Create README.md if missing
      run: |
        if [ ! -f "README.md" ]; then
          echo "ðŸ“š Creating README.md..."
          echo '# âš½ Soccer Prediction Master' > README.md
          echo '' >> README.md
          echo 'Advanced machine learning system for soccer match predictions.' >> README.md
          echo '' >> README.md
          echo '## Setup' >> README.md
          echo '' >> README.md
          echo '1. Clone repository' >> README.md
          echo '2. Run: `python setup.py`' >> README.md
          echo '3. Install: `pip install -r requirements.txt`' >> README.md
          echo '4. Start building!' >> README.md
          echo '' >> README.md
          echo '## Project Structure' >> README.md
          echo '' >> README.md
          echo '- `data/` - Match data' >> README.md
          echo '- `src/` - Source code' >> README.md
          echo '- `models/` - ML models' >> README.md
          echo '- `web_app/` - Dashboard' >> README.md
          echo '' >> README.md
          echo '## License' >> README.md
          echo 'MIT License' >> README.md
          echo "âœ… README.md created"
        else
          echo "ðŸ“š README.md already exists"
        fi
    
    - name: Install dependencies
      run: |
        echo "ðŸ“¦ Installing dependencies..."
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        echo "âœ… Dependencies installed"
    
    - name: Verify installation
      run: |
        echo "ðŸ§ª Verifying installation..."
        python -c "import pandas as pd; import numpy as np; import sklearn; import flask; print('âœ… All packages imported successfully!'); print(f'Pandas version: {pd.__version__}'); print(f'NumPy version: {np.__version__}')"
    
    - name: Test project
      run: |
        echo "ðŸ§ª Testing project..."
        [ -f "requirements.txt" ] && echo "âœ… requirements.txt exists"
        [ -f "setup.py" ] && echo "âœ… setup.py exists"
        [ -f "main.py" ] && echo "âœ… main.py exists"
        [ -d "src/data_collection" ] && echo "âœ… src/data_collection exists"
        [ -f "src/__init__.py" ] && echo "âœ… src/__init__.py exists"
        python -c "print('Testing Python...'); from pathlib import Path; print(f'Current directory: {Path.cwd()}'); print('âœ… Python test passed')"
        echo "âœ… All tests passed!"
    
    - name: Create workflow summary
      run: |
        echo "## ðŸ“Š Workflow Summary" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "### âœ… Project Setup Complete" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "**Files Created:**" >> $GITHUB_STEP_SUMMARY
        echo "- ðŸ“ Project structure with 16 directories" >> $GITHUB_STEP_SUMMARY
        echo "- ðŸ“¦ requirements.txt with 10 packages" >> $GITHUB_STEP_SUMMARY
        echo "- âš™ï¸ setup.py script" >> $GITHUB_STEP_SUMMARY
        echo "- ðŸŽ¯ main.py entry point" >> $GITHUB_STEP_SUMMARY
        echo "- ðŸ“š README.md documentation" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "**Next Steps:**" >> $GITHUB_STEP_SUMMARY
        echo "1. Start building data collection module" >> $GITHUB_STEP_SUMMARY
        echo "2. Implement feature engineering" >> $GITHUB_STEP_SUMMARY
        echo "3. Train ML models" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "**Status:** âœ… Success" >> $GITHUB_STEP_SUMMARY
        echo "**Time:** $(date)" >> $GITHUB_STEP_SUMMARY
